<!DOCTYPE html>
<html>

<head>
    <script type="text/javascript" src="csv.js"></script>
    <script type="text/javascript" src="file.js"></script>
    
    <h1>Izvēlēties darba failus:</h1>
    
    <form id="myForm">
        <label for="csvFile">Pievienojiet <b>personals.csv</b> failu</label>
        <input type="file" id="csvFile" accept=".csv" multiple/>
        <br />
    </form>

    <h1>Personāla izvade pēc:</h1>
    
    <script>
        var personalsViss;

        const struktura = []; // piesardzīgi ar šiem nosaukiem, jo compare funkcijas izmanto
        const strukturaId = []; // abus mainīgos, kā fiksētus 

        document.getElementById("csvFile").addEventListener("change", function(ev) {
        let files = ev.currentTarget.files;
        let readers = [];

        if(!files.length) return;                               // Abort if there were no files selected
                                                                
        for(let i = 0;i < files.length;i++) {                   // Store promises in array
            readers.push(readFileAsText(files[i]));
        }
                
        Promise.all(readers).then((values) => {                     // Trigger Promises
            checkFileAmount(values, 1);                             // file.js
            let viens = stringTo2dArray(values[0],"!", ",");
            compareToPersonals(viens);                              // file.js
        });
    }, false);

        function submitOnClick() {
            let choice = document.getElementById("izvadit").value;
            let personals_len = personalsViss.length;

            var tempArr = [];
            
            if (choice == "strukturvieniba") { 
                tempArr.push(["Grāds", "Vārds", "Uzvārds", 
                "Struktūrvienība 1", "S 2", "S 3",
                "Amats 1", "A 2", "A 3", "Telefona Nr."]);

                for (let i = 1; i < personalsViss.length; i++) {
                    tempArr.push([personalsViss[i][10], personalsViss[i][7], personalsViss[i][9],
                    personalsViss[i][13], personalsViss[i][15], personalsViss[i][17],
                    personalsViss[i][14], personalsViss[i][16], personalsViss[i][18], personalsViss[i][12]]);
                }
                tempArr.splice(personalsViss.length - 1, 1); // removes undefined row(?)

            } else if (choice == "uzvards") {
                tempArr.push(["Grāds", "Vārds", "Uzvārds", 
                "Amats 1", "A 2", "A 3", "Telefona Nr."]);

                for (let i = 1; i < personalsViss.length; i++) {
                    tempArr.push([personalsViss[i][10], personalsViss[i][7], personalsViss[i][9],
                    personalsViss[i][14], personalsViss[i][16], personalsViss[i][18], personalsViss[i][12]]);
                }
                tempArr.splice(personalsViss.length - 1, 1); // removes undefined row(?)        
            } else if (choice == "empty") {
                alert("Lūdzu izvēlaties tipu");
                document.reload();
            }
         
            var table = makeTableHTML(tempArr);
            document.write(table);
        }

    </script>

</head>

<body>
    <form>
        <select name="izvadit" id="izvadit" onchange="myFunction()">
            <option value="empty" selected></option>
            <option value="strukturvieniba">Struktūrvienības</option>
            <option value="uzvards">Personāla uzvārda</option>
        </select>
        <button onclick="submitOnClick()">Izvadīt</button>
    </form>
</body>

</html>