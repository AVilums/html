<!DOCTYPE html>
<html>
<head>
    <script type="text/javascript" src="csv.js"></script>
    <script type="text/javascript" src="file.js"></script>
    <h1>Izvēlēties darba failus:</h1>

    <form id="myForm">
        <label for="csvFile">Pievienojiet <b>amati.csv</b>, <b>presonals.csv</b> un <b>stukturvienibas.csv</b> failus</label>
        <input type="file" id="csvFile" accept=".csv" multiple/>
        <br />
    </form>
    
    <style>
    .amats{
        width: 195pt;    
    }

    .amats2{
        width: 178pt;    
    }
        
    .str{
        width: 148pt;
    }

    .str2{
        width: 131pt;
    }
    </style>
    
    <script>

    // Handle multiple fileuploads
    var amatiViss;
    var strukturasViss;
    var personalsViss;
    
    document.getElementById("csvFile").addEventListener("change", function(ev){
        let files = ev.currentTarget.files;
        let readers = [];

        // Abort if there were no files selected
        if(!files.length) return;

        // Store promises in array
        for(let i = 0;i < files.length;i++){
            readers.push(readFileAsText(files[i]));
        }
                
        // Trigger Promises
        Promise.all(readers).then((values) => {
            // Values will be an array that contains an item
            // with the text of every selected file
            // ["File1 Content", "File2 Content" ... "FileN Content"]
                    
            //prieks viendimensiju parbaudes
            // alert(values[0]);
            // alert(values[1]);
            // alert(values[2]);

            if(values.length != 3){
                alert("Nav izvēlēti 3 faili");
                window.open("pievienotp.html", "_self");
            }
        
            let viens = stringTo2dArray(values[0],"!", ",");
            let divi = stringTo2dArray(values[1],"!", ",");
            let tris = stringTo2dArray(values[2],"!", ",");
                   
            //prieks divdimensiju parbaudes
            //alert(viens[0][0]+"\n"+divi[0][0]+"\n"+tris[0][0]);
            compare(viens,divi,tris);
        });
    }, false);
 
    const amati = [];
    const struktura = [];
    const personals = [];
            
    function compare(viens,divi,tris){
        
        if (viens[0][0]=="Am.ID" && divi[0][0]=="Str.ID" && tris[0][0]=="ID") {
            forpush(viens,divi,tris); 
        }else if (viens[0][0]=="Str.ID" && divi[0][0]=="Am.ID" && tris[0][0]=="ID"){
            forpush(divi,viens,tris);
        }else if (viens[0][0]=="ID" && divi[0][0]=="Str.ID" && tris[0][0]=="Am.ID"){
            forpush(tris,divi,viens);
        }else if (viens[0][0]=="ID" && divi[0][0]=="Am.ID" && tris[0][0]=="Str.ID"){
            forpush(divi,tris,viens);
        }else if (viens[0][0]=="Am.ID" && divi[0][0]=="ID" && tris[0][0]=="Str.ID"){
            forpush(viens,tris,divi);
        }else if (viens[0][0]=="Str.ID" && divi[0][0]=="ID" && tris[0][0]=="Am.ID"){
            forpush(tris,viens,divi);
        }else{ 
            alert("Izvēlēti nepareizi faili");
            window.open("pievienotp.html", "_self");
        }
            //alert(amati);
            //alert(struktura);
            //alert(personals)
    }
    
    function forpush(a,b,c){
        for (let i=1;i<a.length;i++){
            amati.push(a[i][1]);
        } 
                
        for (let i=1;i<b.length;i++){
            struktura.push(b[i][1]);
        }
             
        for (let i=1;i<c.length;i++){
            personals.push(c[i][0]);
        } 

        amatiViss=a;
        strukturasViss=b;
        personalsViss=c;
            //alert(amati);
            //alert(struktura);
            //alert(personals);
            
        GFG_Fun(amati,struktura,personals);
    }

    function GFG_Fun(amati,struktura,personals){
            
            var select = document.getElementById("amats");
            var select2 = document.getElementById("struktura");
            var select3 = document.getElementById("amats2");
            var select4 = document.getElementById("struktura2");
            var select5 = document.getElementById("amats3");
            var select6 = document.getElementById("struktura3");

            for(var i = 0; i < amati.length; i++) {
                var opt = amati[i];
                var el = document.createElement("option");
                el.textContent = opt;
                el.value = opt;

                var el3 = document.createElement("option");
                el3.textContent = opt;
                el3.value = opt;

                var el5 = document.createElement("option");
                el5.textContent = opt;
                el5.value = opt;
        
                select.appendChild(el);
                select3.appendChild(el3);
                select5.appendChild(el5);

            }

            //analogs otra dropdown aizpildei
            for(var i = 0; i < struktura.length; i++) {
                var opt2 = struktura[i];
                var el2 = document.createElement("option");
                el2.textContent = opt2;
                el2.value = opt2;

                var el4 = document.createElement("option");
                el4.textContent = opt2;
                el4.value = opt2;

                var el6 = document.createElement("option");
                el6.textContent = opt2;
                el6.value = opt2;

                select2.appendChild(el2);
                select4.appendChild(el4);
                select6.appendChild(el6);
            }
        }   
    
    function test_print() { 
        let personalsRowCount = personalsViss.length;
        
        alert(personalsRowCount);
    }
    </script>
    
    <h1>Personāla pievienošana</h1>

</head>
<body>
    <form>
        <p>
            <label for="personid">Personas ID:&nbsp; </label>
            <input type="text" id="personid" name="personid"size="34pt">
        </p>
        <p>
            <label for="fname">Name:&nbsp; </label>
            <input type="text" id="fname" name="fname"size="40pt">
        </p>
        <p>
            <label for="lname">Last name:&nbsp; </label>
            <input type="text" id="lname" name="lname"size="36pt">
        </p>
        <p>
            <label for="grads">Grāds:&nbsp; </label>
            <input type="text" id="grads" name="grads"size="40pt">
        </p>
        <p>
            <label for="telnr">Telefona numurs: &nbsp; </label>
            <input type="text" id="telnr" name="telnr"size="29pt">
        </p>
        <p>
            <label for="amats">Amata veids:&nbsp; </label>
            <select name="amats" id="amats" class = "amats"></select>
        </p>
        <p>
            <label for="struktura">Struktūrvienības veids:&nbsp; </label>
            <select name="struktura" id="struktura" class = "str"></select>
        </p>
        <p>
            <label for="amats2">Amata veids (2):&nbsp; </label>
            <select name="amats2" id="amats2" class = "amats2"></select>
        </p>
        <p>
            <label for="struktura2">Struktūrvienības veids (2):&nbsp; </label>
            <select name="struktura2" id="struktura2" class = "str2"></select>
        </p>
        <p>
            <label for="amats3">Amata veids (3):&nbsp; </label>
            <select name="amats3" id="amats3" class = "amats2"></select>
        </p>
        <p>
            <label for="struktura3">Struktūrvienības veids (3):&nbsp; </label>
            <select name="struktura3" id="struktura3" class = "str2"></select>
        </p>
        <p>Datu aizsardzība?&nbsp;
            <label for="aizsardziba">Jā&nbsp; </label>
            <input type="checkbox" id="aizsardziba" name="aizsardziba" value="aizsardziba">
            <label for="neaizsardziba">Nē&nbsp; </label>
            <input type="checkbox" id="neaizsardziba" name="neaizsardziba" value="neaizsardziba">
        </p>
        <p>Vai ir zinātniskie projekti?&nbsp;
            <label for="proj">Jā&nbsp; </label>
            <input type="checkbox" id="proj" name="proj" value="proj">
            <label for="neproj">Nē&nbsp; </label>
            <input type="checkbox" id="neproj" name="neproj" value="neproj">
        </p>
            <button onclick=test_print()>Pievienot</button>
    </form>
</body>

</html>