<!DOCTYPE html>
<html>
<head>
    <h1>
        Izvēlēties darba failus:
    </h1>  
    
        <form id="myForm">
            <label for="csvFile">Pievienojiet amati.csv un stukturvienibas.csv failus</label>
            <input type="file" id="csvFile" accept=".csv" multiple/>
            <br />
            
        </form>

        <style>
            .amats{
                width: 146pt;    
            }
        
            .str{
                width: 100pt;
            }
        </style>
    
        <script>

function readFileAsText(file){
                return new Promise(function(resolve,reject){
                    let fr = new FileReader();

                    fr.onload = function(){
                        resolve(fr.result);
                    };

                    fr.onerror = function(){
                        reject(fr);
                    };

                    fr.readAsText(file);
                });
            }
          
            var d1 = "!";
            var d2 = ",";

            // Handle multiple fileuploads
            document.getElementById("csvFile").addEventListener("change", function(ev){
                let files = ev.currentTarget.files;
                let readers = [];

                // Abort if there were no files selected
                if(!files.length) return;

                // Store promises in array
                for(let i = 0;i < files.length;i++){
                    readers.push(readFileAsText(files[i]));
                }
                
                // Trigger Promises
                Promise.all(readers).then((values) => {
                    // Values will be an array that contains an item
                    // with the text of every selected file
                    // ["File1 Content", "File2 Content" ... "FileN Content"]
                    

                    //prieks viendimensiju parbaudes
                    //alert(values[0]);
                   // alert(values[1]);
                    
                   
                   let viens = stringTo2dArray(values[0],d1, d2);
                    let divi = stringTo2dArray(values[1],d1, d2);
                   
                   //prieks divdimensiju parbaudes
                    //alert(viens[0][0]+"\n"+divi[0][0]);
                    compare(viens,divi);
                });
                
            }, false);
 

            function stringTo2dArray(string, d1, d2) {
             return string.split(d1).map(function(x){return x.split(d2)});
            }

            function compare(viens,divi){
                //alert(viens);
                const amati = [];
                const struktura = [];
                if (viens[0][0]=="Am.ID") {
                    
               for (let i=1;i<viens.length;i++){
                amati.push(viens[i][1]);
                
                 } 
            
                 
               for (let i=1;i<divi.length;i++){
                struktura.push(divi[i][1]);
                 }
                 
                }
                
                else if (viens[0][0]=="Str.ID"){
                    
               for (let i=1;i<viens.length;i++){
                struktura.push(viens[i][1]);
                 }
                
               for (let i=1;i<divi.length;i++){
                amati.push(divi[i][1]);
                 } 
                }
                else { 
                alert("Izvēlēti nepareizi faili");
                window.open("Main.html", "_parent");
            }

            //alert(amati);
            //alert(struktura);
            GFG_Fun(amati,struktura);
            }
           
        
     
    
    function GFG_Fun(amati,struktura){

    var amatiem = amati;
    var strukturas= struktura;


    var select = document.getElementById("amats");
    var select2 = document.getElementById("struktura");
    
    for(var i = 0; i < amatiem.length; i++) {
    var opt = amatiem[i];
    var el = document.createElement("option");
    el.textContent = opt;
    el.value = opt;
    select.appendChild(el);
  }


  //analogs otra dropdown aizpildei
  for(var i = 0; i < strukturas.length; i++) {
    var opt2 = strukturas[i];
    var el2 = document.createElement("option");
    el2.textContent = opt2;
    el2.value = opt2;
    select2.appendChild(el2);
  }
}        


            
          </script>


<h1>Personāla pievienošana</h1>

</script> 
</head>
<body>
    <p><form><label for="personid">Personas ID:&nbsp; </label><input type="text" id="personid" name="personid"size="24pt"></p>
        <label for="fname">Name:&nbsp; </label><input type="text" id="fname" name="fname"size="30pt"></p>
        <label for="lname">Last name:&nbsp; </label><input type="text" id="lname" name="lname"size="26pt"></p>
        <label for="grads">Grāds:&nbsp; </label><input type="text" id="grads" name="grads"size="30pt"></p>
        <label for="telnr">Telefona numurs: &nbsp; </label><input type="text" id="telnr" name="telnr"size="19pt"></form></p>
        <p>
        <label for="amats">Amata veids:&nbsp; </label>
        <select name="amats" id="amats" class = "amats"></select>
        </p>
        <p>
        <label for="struktura">Struktūrvienības veids:&nbsp; </label>
        <select name="struktura" id="struktura" class = "str"></select>
        </p>
        <button onclick="submitOnClick()">Pievienot</button>
</body>

</html>